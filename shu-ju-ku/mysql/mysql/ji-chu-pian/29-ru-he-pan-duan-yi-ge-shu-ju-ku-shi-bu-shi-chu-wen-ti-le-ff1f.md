# 1.如何判断一个数据库是不是出问题了

# 2.总结
## 2.1.思考题
## 2.2.高质量问题
**1.老师我有两个问题:**
* 1.innodb_thread_concurrency的设置是不是应该跟计算机核数成正比,一般是1.5倍-2倍左右？
* 2.怎么之前遇到空间满了,数据库都登不上了,所有的连接都连不上,更不用执行select语句了,这个是什么原因啊？

**回复: **
* 1.虽然理论上是核数的2倍左右最好，但是现在很多人把MySQL创建在虚拟机上，就分1~2个核，我怕那么写，有同学会认为innodb_thread_concurrency建议设置成4。

* 2.空间满本身是不会导致连不上的。但是因为空间满，事务无法提交，可能会导致接下来外部事务重试，新重试的业务还是堵在提交阶段，持续累积可能会把连接数用满

**2.现在很多公司都是使用dubbo或者类似dubbo的rpc调用。说说我对dubbo的理解 
dubbo 存活检测感觉分为下面三个层面**
1.服务端与注册中心的链接状态
通常注册中心是zookeeper，服务端注册临时节点，客户端注册这个节点的watch事件，一但服务端失联，
客户端将把该服务从自己可用服务列表中移除。（一个服务通常有多个提供者，只是把失联的提供者移除）。
zookeeper是通过心跳发现服务提供者失联的，心跳实际上就是以固定的频率（比如每秒）发送检测的数据包；

2.客户端与注册中心的链接状态
客户端与zookeeper失联，会暂时使用自己缓存的服务提供者列表。如果每个提供者多次调不通，把它移除。

3.客户端与服务单的链接状态
    服务端提供类似于echo的方法，客户定时调用。部分返回正常，认为服务处于亚健康状态，如果超过阀值，会被降级
    从服务提供者列表移除。被移除的方法可能会在超过一定时间后，拿回来重试，可以恢复成正常服务，也可能继续降级。
    
**回复: **很好的实践分享。
是不是还有配套一些服务的RT时间的报告？
毕竟echo是一个比较轻量的调用，正确率可能比实际业务调用的正确率高

**3.老师，文中提到的“但是，如果主库 A 和备库 B 都用相同的更新命令，就可能出现行冲突，也就是可能会导致主备同步停止。”，这个能展开说一下吗，这个行冲突指什么？它们会都更新各自检测表的同一字段我觉得会带来不准确的问题，怎么导致主从同步停止了呢？**

**回复: **好问题

比如两个表刚开始都是空表，
然后第一个语句执行
insert into mysql.health_check(id, t_modified) values (1, now()) on duplicate key update t_modified=now();

就会两边各写入一个insert语句的binlog日志，传到对面就导致同步停止了