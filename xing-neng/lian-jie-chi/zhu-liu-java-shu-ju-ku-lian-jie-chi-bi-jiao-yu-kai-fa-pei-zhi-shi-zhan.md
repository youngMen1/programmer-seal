# 主流Java数据库连接池比较与开发配置实战

## 1.数据库连接池概述

数据库连接的建立是一种耗时、性能低、代价高的操作，频繁的数据库连接的建立和关闭极大的影响了系统的性能。数据库连接池是系统初始化过程中创建一定数量的数据库连接放于连接池中，当程序需要访问数据库时，不再建立一个新的连接，而是从连接池中取出一个已建立的空闲连接，使用完毕后，程序将连接归还到连接池中，供其他请求使用，从而实现的资源的共享，连接的建立、断开都由连接池自身来管理。

数据库连接池为系统的运行带来了以下优势：昂贵的数据库连接资源得到重用；减少了数据库连接建立和释放的时间开销，提高了系统响应速度；统一的数据库连接管理，避免了连接资源的泄露。

**数据库连接池运行机制：**

系统初始化时创建连接池，程序操作数据库时从连接池中获取空闲连接，程序使用完毕将连接归还到连接池中，系统退出时，断开所有数据库连接并释放内存资源。

20170327160954867.png

# 2.主流数据库连接池比较

常用的主流开源数据库连接池有C3P0、DBCP、Tomcat Jdbc Pool、BoneCP、Druid等

**C3p0**: 开源的JDBC连接池，实现了数据源和JNDI绑定，支持JDBC3规范和JDBC2的标准扩展。目前使用它的开源项目有Hibernate、Spring等。单线程，性能较差，适用于小型系统，代码600KB左右。

**DBCP \(Database Connection Pool\):**由Apache开发的一个Java数据库连接池项目， Jakarta commons-pool对象池机制，Tomcat使用的连接池组件就是DBCP。单独使用dbcp需要3个包：common-dbcp.jar,common-pool.jar,common-collections.jar，预先将数据库连接放在内存中，应用程序需要建立数据库连接时直接到连接池中申请一个就行，用完再放回。单线程，并发量低，性能不好，适用于小型系统。

**Tomcat Jdbc Pool：**Tomcat在7.0以前都是使用common-dbcp做为连接池组件，但是dbcp是单线程，为保证线程安全会锁整个连接池，性能较差，dbcp有超过60个类，也相对复杂。Tomcat从7.0开始引入了新增连接池模块叫做Tomcat jdbc pool，基于Tomcat JULI，使用Tomcat日志框架，完全兼容dbcp，通过异步方式获取连接，支持高并发应用环境，超级简单核心文件只有8个，支持JMX，支持XA Connection。

**BoneCP：**官方说法BoneCP是一个高效、免费、开源的Java数据库连接池实现库。设计初衷就是为了提高数据库连接池性能，根据某些测试数据显示，BoneCP的速度是最快的，要比当时第二快速的连接池快25倍左右，完美集成到一些持久化产品如Hibernate和DataNucleus中。BoneCP特色：高度可扩展，快速；连接状态切换的回调机制；允许直接访问连接；自动化重置能力；JMX支持；懒加载能力；支持XML和属性文件配置方式；较好的Java代码组织，100%单元测试分支代码覆盖率；代码40KB左右。

**Druid：**Druid是Java语言中最好的数据库连接池，Druid能够提供强大的监控和扩展功能，是一个可用于大数据实时查询和分析的高容错、高性能的开源分布式系统，尤其是当发生代码部署、机器故障以及其他产品系统遇到宕机等情况时，Druid仍能够保持100%正常运行。主要特色：为分析监控设计；快速的交互式查询；高可用；可扩展；Druid是一个开源项目，源码托管在github上。

**主流连接池各项功能对比如下：**

20170327155830605.png

# 3.数据库连接池Spring集成配置与JNDI配置

下面针对每一种连接池的使用方法，在开发中如何配置给出spring集成配置和在tomcat的conf/context.xml文件中配置2种方式，限于篇幅只给出基本参数，详细参数可自行研究。

#### **3.1 阿里Druid连接池    **

#### ** Maven依赖**

```
<dependency>
  <groupId>com.alibaba</groupId>
  <artifactId>druid</artifactId>
  <version>1.0.28</version>
</dependency>
```

## 4.总结

```
 本文所比较的5种数据库连接池在性能方面，根据个人测试结果和参考网上资料Druid &gt; TomcatJDBC &gt; DBCP &gt; C3P0，BoneCP的性能方面没有深入比较，应该和Tomcat Jdbc差不多。对于小型的系统，并发压力不大时，选择哪一种数据库连接池差别不会很大，主要考虑的应该是连接池的稳定性。当并发量较高时，一般不会选择使用DBCP和C3P0，选择Druid是较好的。本文给出了5种数据库连接池通过Spring配置和Tomcat JNDI方式配置两种方式，Spring配置一般使用单独的属性文件，每一个连接池都提供了使用代码创建的方式，使用方式也比较类似，感兴趣可以自行研究。另外连接不同的数据库时，在配置方面的差异主要在driverClass和jdbcUrl两项，优化配置项可以另行考虑。
```

欢迎大家关注博主订阅号“Java技术日志”，提供Java相关技术分享，从Java编程基础到Java高级技术，从JavaWeb技术基础Jsp、Servlet、JDBC到SSH、SSM开发框架，从REST风格接口设计到分布式项目实战。剖析主流开源技术框架，用亲身实践来谱写深度Java技术日志。

